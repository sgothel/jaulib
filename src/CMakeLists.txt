set (jaulib_LIB_INCLUDE_DIRS
  ${CMAKE_CURRENT_SOURCE_DIR}/../include
)

include_directories(
  ${jaulib_LIB_INCLUDE_DIRS}
  ${CMAKE_CURRENT_BINARY_DIR}
  ${SYS_INCLUDE_DIRS}
)

set (jaulib_LIB_SRCS
  base_codec.cpp
  basic_types.cpp
  byte_stream.cpp
  cpuid.cpp
  debug.cpp
  dfa_utf8_decode.cpp
  environment.cpp
  eui48.cpp
  file_util.cpp
  io_util.cpp
  os_support.cpp
  service_runner.cpp
  simple_timer.cpp
  uuid.cpp
  unix/unix_dyn_linker.cpp
  unix/user_info.cpp
  windows/windows_dyn_linker.cpp
# autogenerated files
  ${CMAKE_CURRENT_BINARY_DIR}/version.cpp
)

if (EMSCRIPTEN)
  add_library (jaulib STATIC ${jaulib_LIB_SRCS})
else()
  add_library (jaulib SHARED ${jaulib_LIB_SRCS})
endif()

target_link_libraries (
  jaulib
  ${LIBCURL_LIBNAME}
  ${LIBUNWIND_LIBNAME}
  ${CMAKE_THREAD_LIBS_INIT}
)

if( (USE_STRIP) AND (NOT EMSCRIPTEN) )
add_custom_command(TARGET jaulib POST_BUILD
                   COMMAND ${STRIP} ${CMAKE_CURRENT_BINARY_DIR}/${CMAKE_SHARED_LIBRARY_PREFIX}jaulib${CMAKE_SHARED_LIBRARY_SUFFIX}.${jaulib_VERSION_SHORT}
                   COMMENT "stripping jaulib"
                   VERBATIM
                   )
endif()

set_target_properties(
   jaulib
   PROPERTIES
   SOVERSION ${jaulib_VERSION_MAJOR}
   VERSION ${jaulib_VERSION_SHORT}
)
install (DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/../include/jau/ DESTINATION include/jau)

install(TARGETS jaulib LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})

